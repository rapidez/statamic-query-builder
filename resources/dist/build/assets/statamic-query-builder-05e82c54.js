function l(t,e,s,i,a,o,p,u){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=s,r._compiled=!0),i&&(r.functional=!0),o&&(r._scopeId="data-v-"+o);var d;if(p?(d=function(n){n=n||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!n&&typeof __VUE_SSR_CONTEXT__<"u"&&(n=__VUE_SSR_CONTEXT__),a&&a.call(this,n),n&&n._registeredComponents&&n._registeredComponents.add(p)},r._ssrRegister=d):a&&(d=u?function(){a.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:a),d)if(r.functional){r._injectStyles=d;var v=r.render;r.render=function(f,_){return d.call(_),v(f,_)}}else{var c=r.beforeCreate;r.beforeCreate=c?[].concat(c,d):[d]}return{exports:t,options:r}}const m={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}},methods:{getDateValue(){const t=this.condition.value;if(!t||typeof t=="string")return{selectedOption:"TODAY",offset:1,manualDate:""};if(t.type==="relative"){if(t.value)return{selectedOption:t.value,offset:1,manualDate:""};if(t.base){const e=t.offset>=0?"PLUS":"MINUS";return{selectedOption:`${t.base}_${e}_${t.unit.toUpperCase()}`,offset:Math.abs(t.offset),manualDate:""}}}else if(t.type==="manual")return{selectedOption:"OTHER",offset:1,manualDate:t.value};return{selectedOption:"TODAY",offset:1,manualDate:""}},getDateValueOptions(){return[{value:"TODAY",label:this.__("Today")},{value:"TOMORROW",label:this.__("Tomorrow")},{value:"YESTERDAY",label:this.__("Yesterday")},{value:"TODAY_PLUS_DAYS",label:this.__("Today + X days")},{value:"TODAY_PLUS_WEEKS",label:this.__("Today + X weeks")},{value:"TODAY_PLUS_MONTHS",label:this.__("Today + X months")},{value:"TODAY_PLUS_YEARS",label:this.__("Today + X years")},{value:"TODAY_MINUS_DAYS",label:this.__("Today - X days")},{value:"TODAY_MINUS_WEEKS",label:this.__("Today - X weeks")},{value:"TODAY_MINUS_MONTHS",label:this.__("Today - X months")},{value:"TODAY_MINUS_YEARS",label:this.__("Today - X years")},{value:"OTHER",label:this.__("Other...")}]},needsOffsetInput(t){return["TODAY_PLUS_DAYS","TODAY_PLUS_WEEKS","TODAY_PLUS_MONTHS","TODAY_PLUS_YEARS","TODAY_MINUS_DAYS","TODAY_MINUS_WEEKS","TODAY_MINUS_MONTHS","TODAY_MINUS_YEARS"].includes(t)},getOffsetLabel(t){return{TODAY_PLUS_DAYS:this.__("Days"),TODAY_MINUS_DAYS:this.__("Days"),TODAY_PLUS_WEEKS:this.__("Weeks"),TODAY_MINUS_WEEKS:this.__("Weeks"),TODAY_PLUS_MONTHS:this.__("Months"),TODAY_MINUS_MONTHS:this.__("Months"),TODAY_PLUS_YEARS:this.__("Years"),TODAY_MINUS_YEARS:this.__("Years")}[t]||""},onDateOptionChange(t){if(["TODAY","TOMORROW","YESTERDAY"].includes(t))this.$emit("update-value",{type:"relative",value:t});else if(this.needsOffsetInput(t)){const e=t.split("_"),s=e[0],i=e[1],a=e[2].toLowerCase();this.$emit("update-value",{type:"relative",base:s,offset:i==="MINUS"?-1:1,unit:a})}else t==="OTHER"&&this.$emit("update-value",{type:"manual",value:""})},updateDateOffset(t){const e=this.condition.value;if(e.type==="relative"&&e.base){const s=e.offset>=0?1:-1;this.$emit("update-value",{...e,offset:s*Math.abs(parseInt(t)||1)})}},updateManualDate(t){this.$emit("update-value",{type:"manual",value:t})}}};var g=function(){var e=this,s=e._self._c;return s("div",{staticClass:"flex items-center space-x-2 flex-1"},[s("v-select",{staticClass:"flex-1",attrs:{value:e.getDateValue().selectedOption,options:e.getDateValueOptions(),reduce:i=>i.value,label:"label",placeholder:e.__("Select date option")},on:{input:e.onDateOptionChange}}),e.needsOffsetInput(e.getDateValue().selectedOption)?[s("input",{staticClass:"input-text w-20",attrs:{type:"number",placeholder:1,min:"1"},domProps:{value:e.getDateValue().offset},on:{input:function(i){return e.updateDateOffset(i.target.value)}}}),s("span",{staticClass:"text-sm font-medium text-gray-600"},[e._v(" "+e._s(e.getOffsetLabel(e.getDateValue().selectedOption))+" ")])]:e._e(),e.getDateValue().selectedOption==="OTHER"?s("input",{staticClass:"input-text flex-1",attrs:{type:"date"},domProps:{value:e.getDateValue().manualDate},on:{input:function(i){return e.updateManualDate(i.target.value)}}}):e._e()],2)},b=[],y=l(m,g,b,!1,null,null,null,null);const C=y.exports,x={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}},computed:{isMultiSelect(){var t;return((t=this.field)==null?void 0:t.type)==="select"&&["IN","NOT IN"].includes(this.condition.operator)}}};var O=function(){var e=this,s=e._self._c;return s("div",{staticClass:"flex-1 min-w-0"},[e.isMultiSelect?s("v-select",{attrs:{value:e.condition.value,options:e.field.options||[],reduce:i=>i.value,label:"label",multiple:"",placeholder:e.__("Select Values")},on:{input:function(i){return e.$emit("update-value",i)}}}):s("v-select",{attrs:{value:e.condition.value,options:e.field.options||[],reduce:i=>i.value,label:"label",placeholder:e.__("Select Value")},on:{input:function(i){return e.$emit("update-value",i)}}})],1)},S=[],T=l(x,O,S,!1,null,null,null,null);const D=T.exports,N={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}},methods:{getBetweenValue(){const t=this.condition.value;return!t||typeof t=="string"?{min:"",max:""}:Array.isArray(t)?{min:t[0]||"",max:t[1]||""}:t},updateMin(t){const e=this.getBetweenValue();this.$emit("update-value",[t,e.max])},updateMax(t){const e=this.getBetweenValue();this.$emit("update-value",[e.min,t])}}};var $=function(){var e=this,s=e._self._c;return s("div",{staticClass:"flex items-center space-x-2 flex-1"},[s("input",{staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Min value")},domProps:{value:e.getBetweenValue().min},on:{input:function(i){return e.updateMin(i.target.value)}}}),s("span",[e._v(e._s(e.__("and")))]),s("input",{staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Max value")},domProps:{value:e.getBetweenValue().max},on:{input:function(i){return e.updateMax(i.target.value)}}})])},I=[],A=l(N,$,I,!1,null,null,null,null);const w=A.exports,V={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}}};var E=function(){var e=this,s=e._self._c;return s("div",{staticClass:"flex items-center space-x-2 flex-1"},[s("input",{staticClass:"input-text flex-1",attrs:{type:"number",placeholder:e.__("Number of days"),min:"1"},domProps:{value:e.condition.value},on:{input:function(i){e.$emit("update-value",parseInt(i.target.value)||1)}}}),s("span",[e._v(e._s(e.__("days")))])])},G=[],F=l(V,E,G,!1,null,null,null,null);const M=F.exports,k={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}}};var Y=function(){var e=this,s=e._self._c;return s("input",{staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Enter value")},domProps:{value:e.condition.value},on:{input:function(i){return e.$emit("update-value",i.target.value)}}})},L=[],P=l(k,Y,L,!1,null,null,null,null);const U=P.exports,h={methods:{getField(t){return this.fields.find(e=>e.value===t)},getFieldOperators(t){return this.operators[t]||this.operators.text},getFieldOptions(t){const e=this.fields.find(s=>s.value===t);return(e==null?void 0:e.options)||[]},isDateField(t){const e=this.fields.find(s=>s.value===t);return(e==null?void 0:e.type)==="date"},isMultiSelectVisible(t){const e=this.fields.find(s=>s.value===(t==null?void 0:t.attribute));return(e==null?void 0:e.type)==="select"&&["IN","NOT IN"].includes(t==null?void 0:t.operator)},isSingleSelectVisible(t){const e=this.fields.find(s=>s.value===(t==null?void 0:t.attribute));return(e==null?void 0:e.type)==="select"&&!["IN","NOT IN"].includes(t==null?void 0:t.operator)},needsValueInput(t){return!["IS_NULL","IS_NOT_NULL","THIS_WEEK","THIS_MONTH","THIS_YEAR"].includes(t)},needsBetweenInput(t){return["BETWEEN","NOT_BETWEEN"].includes(t)},needsDaysInput(t){return["LAST_X_DAYS","NEXT_X_DAYS"].includes(t)},getOperatorsForType(t){var s;const e=this.fields.find(i=>i.value===t);return e?((s=this.operators)==null?void 0:s[e.type])||[]:[]},initializeGroups(){var t,e;return(e=(t=this.value)==null?void 0:t.groups)!=null&&e.length?this.value.groups:[{conjunction:"AND",conditions:[]}]}}},j={components:{DateValueInput:C,SelectValueInput:D,BetweenValueInput:w,DaysValueInput:M,TextValueInput:U},mixins:[h],props:{condition:{type:Object,required:!0},conditionIndex:{type:Number,required:!0},groupIndex:{type:Number,required:!0},fields:{type:Array,required:!0},operators:{type:Object,required:!0}},methods:{getValueInputComponent(){return this.isMultiSelectVisible(this.condition)||this.isSingleSelectVisible(this.condition)?"SelectValueInput":this.needsBetweenInput(this.condition.operator)?"BetweenValueInput":this.needsDaysInput(this.condition.operator)?"DaysValueInput":this.isDateField(this.condition.attribute)?"DateValueInput":"TextValueInput"},getCurrentField(){return this.fields.find(t=>t.value===this.condition.attribute)},getOperatorsForType(t){const e=this.getCurrentField();return e&&e.operators?e.operators.map(s=>({value:s,label:this.getOperatorLabel(s)})):e&&this.operators[e.type]?this.operators[e.type]:this.operators.text},getOperatorLabel(t){const s=[...this.operators.text,...this.operators.select,...this.operators.number,...this.operators.date].find(i=>i.value===t);return s?s.label:t},updateAttribute(t){var s;const e={...this.condition,attribute:t,operator:((s=this.getOperatorsForType(t)[0])==null?void 0:s.value)||"=",value:this.getDefaultValueForField(t)};this.$emit("update-condition",this.conditionIndex,e)},updateOperator(t){const e={...this.condition,operator:t,value:this.getDefaultValueForOperator(t)};this.$emit("update-condition",this.conditionIndex,e)},updateValue(t){const e={...this.condition,value:t};this.$emit("update-condition",this.conditionIndex,e)},getDefaultValueForField(t){const e=this.fields.find(s=>s.value===t);return(e==null?void 0:e.type)==="date"?{type:"relative",value:"TODAY"}:""},getDefaultValueForOperator(t){return this.needsBetweenInput(t)?{min:"",max:""}:this.needsValueInput(t)?this.condition.value:null}}};var R=function(){var e=this,s=e._self._c;return s("div",{staticClass:"flex items-center space-x-4 p-3 rounded-md"},[s("v-select",{staticClass:"w-1/3",attrs:{value:e.condition.attribute,options:e.fields,reduce:i=>i.value,label:"label",placeholder:e.__("Select Field")},on:{input:e.updateAttribute}}),s("v-select",{staticClass:"w-1/4",attrs:{value:e.condition.operator,options:e.getOperatorsForType(e.condition.attribute),reduce:i=>i.value,label:"label",placeholder:e.__("Select Operator")},on:{input:e.updateOperator}}),e.needsValueInput(e.condition.operator)?[s(e.getValueInputComponent(),{tag:"component",attrs:{condition:e.condition,field:e.getCurrentField()},on:{"update-value":e.updateValue}})]:e._e(),s("button",{staticClass:"btn-danger",attrs:{title:"Remove condition"},on:{click:function(i){return e.$emit("remove-condition",e.conditionIndex)}}},[e._v(" × ")])],2)},H=[],q=l(j,R,H,!1,null,null,null,null);const B=q.exports,W={name:"QueryGroup",components:{QueryCondition:B},props:{group:{type:Object,required:!0},groupIndex:{type:Number,required:!0},parentGroupIndex:{type:Number,default:null},fields:{type:Array,required:!0},operators:{type:Object,required:!0},isNested:{type:Boolean,default:!1},displayIndex:{type:[Number,String],default:null},canMoveUp:{type:Boolean,default:!1},canMoveDown:{type:Boolean,default:!1},canRemove:{type:Boolean,default:!0},canDuplicate:{type:Boolean,default:!0}},data(){return{logicalOperators:["AND","OR"],isCollapsed:!1}},computed:{addOptions(){return[{label:__("Add Condition"),value:"condition"},{label:__("Add Nested Group"),value:"nested-group"}]},hasConditions(){return this.group.conditions&&this.group.conditions.length>0},actualDisplayIndex(){return this.displayIndex!==null?this.displayIndex:this.groupIndex+1}},methods:{handleAddSelection(t){this.$emit(t==="condition"?"add-condition":"add-nested-group",this.groupIndex)},toggleCollapsed(){this.isCollapsed=!this.isCollapsed},getCollapsedSummary(){const t=this.group.conditions.filter(i=>!i.type||i.type!=="group"),e=this.group.conditions.filter(i=>i.type==="group"),s=[];return t.length>0&&s.push(`${t.length} condition${t.length!==1?"s":""}`),e.length>0&&s.push(`${e.length} nested group${e.length!==1?"s":""}`),s.join(", ")||__("No conditions")},getItemKey(t,e){return t.type==="group"?`nested-group-${e}`:`condition-${e}`},getNestedGroupIndex(t){let e=0;for(let s=0;s<t;s++)this.group.conditions[s].type==="group"&&e++;return e},updateConjunction(t){const e={...this.group,conjunction:t};this.$emit("update-group",this.groupIndex,e)},updateCondition(t,e){this.$emit("update-condition",this.groupIndex,t,e)},removeCondition(t){this.$emit("remove-condition",this.groupIndex,t)},updateNestedGroup(t,e){const s={...this.group};s.conditions[t]={...e,type:"group"},this.$emit("update-group",this.groupIndex,s)},removeNestedGroup(t){const e={...this.group};e.conditions.splice(t,1),this.$emit("update-group",this.groupIndex,e)},duplicateNestedGroup(t){const e={...this.group},s=e.conditions[t];e.conditions.splice(t+1,0,{...s,type:"group"}),this.$emit("update-group",this.groupIndex,e)},moveNestedGroupUp(t){if(t>0){const e={...this.group},s=e.conditions[t];e.conditions[t]=e.conditions[t-1],e.conditions[t-1]=s,this.$emit("update-group",this.groupIndex,e)}},moveNestedGroupDown(t){if(t<this.group.conditions.length-1){const e={...this.group},s=e.conditions[t];e.conditions[t]=e.conditions[t+1],e.conditions[t+1]=s,this.$emit("update-group",this.groupIndex,e)}},emitEvent(t,...e){this.$emit(t,this.groupIndex,...e)}}};var X=function(){var e=this,s=e._self._c;return s("div",{class:["border rounded-lg p-4",e.isNested?"border-blue-200 bg-blue-50/30":"border-gray-300"]},[s("div",{staticClass:"flex items-center justify-between mb-4 pb-2 border-b border-gray-200"},[s("div",{staticClass:"flex items-center space-x-4"},[s("div",{staticClass:"flex items-center space-x-2"},[e.isNested?s("span",{staticClass:"text-blue-600"},[e._v("⚬")]):e._e(),s("h3",{class:["font-bold",e.isNested?"text-sm text-blue-700":"text-base"]},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.group.name,expression:"group.name"}],staticClass:"input-text",attrs:{type:"text",placeholder:(e.isNested?e.__("Nested Group"):e.__("Group"))+" "+e.displayIndex},domProps:{value:e.group.name},on:{input:function(i){i.target.composing||e.$set(e.group,"name",i.target.value)}}})]),e.hasConditions?s("button",{staticClass:"text-blue-600 hover:text-blue-800",attrs:{title:e.isCollapsed?e.__("Expand"):e.__("Collapse")},on:{click:e.toggleCollapsed}},[e._v(" "+e._s(e.isCollapsed?"▶":"▼")+" ")]):e._e()]),s("v-select",{staticClass:"w-32",attrs:{value:e.group.conjunction,options:e.logicalOperators},on:{input:e.updateConjunction}})],1),s("div",{staticClass:"flex items-center space-x-2"},[s("v-select",{staticClass:"w-40",attrs:{options:e.addOptions,reduce:i=>i.value,label:"label",placeholder:e.__("Add...")},on:{input:e.handleAddSelection}}),s("div",{staticClass:"flex items-center space-x-1"},[e.canMoveUp?s("button",{staticClass:"btn p-2",attrs:{title:e.__("Move group up")},on:{click:function(i){return e.$emit("move-group-up",e.groupIndex)}}},[e._v(" ↑ ")]):e._e(),e.canMoveDown?s("button",{staticClass:"btn p-2",attrs:{title:e.__("Move group down")},on:{click:function(i){return e.$emit("move-group-down",e.groupIndex)}}},[e._v(" ↓ ")]):e._e()]),e.canRemove?s("button",{staticClass:"btn-danger",on:{click:function(i){return e.$emit("remove-group",e.groupIndex)}}},[e._v(" "+e._s(e.__("Remove Group"))+" ")]):e._e(),e.canDuplicate?s("button",{staticClass:"btn-primary",on:{click:function(i){return e.$emit("duplicate-group",e.groupIndex)}}},[s("svg",{staticClass:"size-6",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"}},[s("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}})])]):e._e()],1)]),e.isCollapsed&&e.hasConditions?s("div",{staticClass:"text-sm text-gray-600"},[e._v(" "+e._s(e.getCollapsedSummary())+" ")]):e._e(),e.isCollapsed?e._e():s("div",{staticClass:"space-y-3"},[e._l(e.group.conditions,function(i,a){return[!i.type||i.type!=="group"?s("query-condition",{key:e.getItemKey(i,a),attrs:{condition:i,"condition-index":a,"group-index":e.groupIndex,fields:e.fields,operators:e.operators},on:{"update-condition":e.updateCondition,"remove-condition":e.removeCondition}}):s("query-group",{key:e.getItemKey(i,a),attrs:{group:i,"group-index":a,"parent-group-index":e.groupIndex,fields:e.fields,operators:e.operators,"is-nested":!0,"display-index":e.getNestedGroupIndex(a)+1,"can-move-up":a>0,"can-move-down":a<e.group.conditions.length-1,"can-remove":!0},on:{"update-group":e.updateNestedGroup,"remove-group":e.removeNestedGroup,"duplicate-group":e.duplicateNestedGroup,"move-group-up":e.moveNestedGroupUp,"move-group-down":e.moveNestedGroupDown,"add-condition":function(o){return e.emitEvent("add-condition-to-nested",o)},"add-nested-group":function(o){return e.emitEvent("add-nested-group-to-nested",o)},"update-condition":function(o){return e.emitEvent("update-nested-condition",o)},"remove-condition":function(o){return e.emitEvent("remove-nested-condition",o)}}})]})],2),e.hasConditions?e._e():s("div",{staticClass:"text-center py-4 text-gray-500 text-sm"},[e._v(" "+e._s(e.__("No conditions added yet"))+" ")])])},z=[],K=l(W,X,z,!1,null,null,null,null);const Q=K.exports;const Z={components:{QueryGroup:Q},mixins:[Fieldtype,h],props:{fields:{type:Array,required:!0,validator:t=>t.length===0?!0:t[0].label&&t[0].options?t.every(e=>"label"in e&&"options"in e&&e.options.every(s=>"label"in s&&"value"in s&&"type"in s)):t.every(e=>"label"in e&&"value"in e&&"type"in e)},sortFields:{type:Array,required:!0,validator:t=>t.every(e=>"label"in e&&"value"in e&&"type"in e)},defaultSortField:{type:String,default:""},defaultSortDirection:{type:String,default:"desc"},defaultBuilderTemplate:{type:String,default:""},builderTemplates:{type:Array,default:[]},operators:{type:Object,default:()=>({text:[{value:"=",label:__("Is exactly")},{value:"!=",label:__("Is not")},{value:"LIKE",label:__("Contains")},{value:"NOT LIKE",label:__("Does not contain")},{value:"STARTS_WITH",label:__("Starts with")},{value:"ENDS_WITH",label:__("Ends with")},{value:"IS_NULL",label:__("Is empty")},{value:"IS_NOT_NULL",label:__("Is not empty")}],select:[{value:"=",label:__("Is")},{value:"!=",label:__("Is not")},{value:"IN",label:__("Is any of")},{value:"NOT IN",label:__("Is none of")},{value:"IS_NULL",label:__("Nothing selected")},{value:"IS_NOT_NULL",label:__("Has selection")}],number:[{value:"=",label:__("Equals")},{value:"!=",label:__("Does not equal")},{value:">",label:__("Greater than")},{value:"<",label:__("Less than")},{value:">=",label:__("Greater than or equal to")},{value:"<=",label:__("Less than or equal to")},{value:"BETWEEN",label:__("Is between")},{value:"NOT_BETWEEN",label:__("Is not between")},{value:"IS_NULL",label:__("Is empty")},{value:"IS_NOT_NULL",label:__("Is not empty")}],date:[{value:"=",label:__("Is on")},{value:"!=",label:__("Is not on")},{value:">",label:__("Is after")},{value:"<",label:__("Is before")},{value:">=",label:__("Is on or after")},{value:"<=",label:__("Is on or before")},{value:"BETWEEN",label:__("Is between")},{value:"NOT_BETWEEN",label:__("Is not between")},{value:"LAST_X_DAYS",label:__("In the last days")},{value:"NEXT_X_DAYS",label:__("In the next days")},{value:"THIS_WEEK",label:__("This week")},{value:"THIS_MONTH",label:__("This month")},{value:"THIS_YEAR",label:__("This year")},{value:"IS_NULL",label:__("No date set")},{value:"IS_NOT_NULL",label:__("Has date")}]})},defaultLimit:{type:Number,default:100},showLimit:{type:Boolean,default:!0}},data(){return{groups:[],builderTemplate:"",limit:100,globalConjunction:"AND",logicalOperators:["AND","OR"],sortField:"",sortDirection:"",sortDirections:["ASC","DESC"],presets:[],showConflictModal:!1,pendingPreset:null}},computed:{flattenedFields(){var t;return(t=this.fields[0])!=null&&t.options?this.fields.flatMap(e=>e.options):this.fields},groupedPresets(){const t=[];return Object.keys(this.presets).forEach(e=>{const s=this.presets[e];t.push({name:s.label,category:s.label,disabled:!0,isHeader:!0}),s.presets.forEach(i=>{t.push({...i,categoryKey:e,isHeader:!1})})}),t}},methods:{async fetchPresets(){try{const t=await this.$axios.get("/cp/rapidez/query-presets");t.data.success?this.presets=t.data.categories:this.$toast.error(__("Failed to load query presets"))}catch(t){console.error("Error fetching presets:",t),this.$toast.error(__("Error loading presets"))}},handlePresetSelection(t){!t||t.disabled||t.isHeader||(this.groups.length>0?(this.pendingPreset=t,this.showConflictModal=!0):this.applyPresetDirectly(t))},applyPreset(t){this.showConflictModal=!1,t==="override"?(this.groups=[],this.applyPresetDirectly(this.pendingPreset)):t==="merge"&&this.applyPresetDirectly(this.pendingPreset,!0),this.pendingPreset=null},cancelPresetApplication(){this.showConflictModal=!1,this.pendingPreset=null},applyPresetDirectly(t,e=!1){const s=this.validateAndCorrectPreset(t.query);e?this.groups.push(...s.groups):(this.groups=s.groups,this.globalConjunction=s.globalConjunction),this.updateValue()},validateAndCorrectPreset(t){const e={groups:[],globalConjunction:t.globalConjunction||"AND"},s=[];return t.groups.forEach((i,a)=>{const o=this.validateGroup(i,s);o.conditions.length>0&&e.groups.push(o)}),s.length>0&&s.forEach(i=>{this.$toast.info(i)}),e},validateGroup(t,e){const s={conjunction:t.conjunction||"AND",conditions:[]};return t.conditions.forEach(i=>{if(i.type==="group"){const a=this.validateGroup(i,e);a.conditions.length>0&&s.conditions.push({...a,type:"group"})}else{const a=this.validateCondition(i,e);a&&s.conditions.push(a)}}),s},validateCondition(t,e){var p;const s=this.flattenedFields.find(u=>u.value===t.attribute);if(!s)return e.push(`Field "${t.attribute}" not found - skipping condition`),null;const i={...t},a=this.getOperatorsForField(s);if(!a.some(u=>u.value===t.operator)){const u=((p=a[0])==null?void 0:p.value)||"=";e.push(`Operator "${t.operator}" not valid for field "${s.label}" - using "${u}"`),i.operator=u}return i},getOperatorsForField(t){return t&&t.operators?t.operators.map(e=>({value:e,label:this.getOperatorLabel(e)})):t?this.operators[t.type]||this.operators.text:this.operators.text},getOperatorLabel(t){const s=[...this.operators.text,...this.operators.select,...this.operators.number,...this.operators.date].find(i=>i.value===t);return s?s.label:t},initializeLimit(){var t;return(t=this.value)!=null&&t.limit?this.value.limit:this.defaultLimit},initializeSortField(){var t;return(t=this.value)!=null&&t.sortField?this.value.sortField:this.defaultSortField},initializeSortDirection(){var t;return(t=this.value)!=null&&t.sortDirection?this.value.sortDirection:this.defaultSortDirection},initializeBuilderTemplate(){var t;return(t=this.value)!=null&&t.builderTemplate?this.value.builderTemplate:this.defaultBuilderTemplate},createDefaultGroup(){return{name:"",conjunction:"AND",conditions:[]}},addGroup(){this.groups.push(this.createDefaultGroup()),this.updateValue()},insertGroupAt(t){this.groups.splice(t,0,this.createDefaultGroup()),this.updateValue()},duplicateGroup(t){const e=this.groups[t];this.groups.splice(t+1,0,{...e}),this.updateValue()},removeGroup(t){this.groups.splice(t,1),this.updateValue()},updateGroup(t,e){this.$set(this.groups,t,e),this.updateValue()},moveGroupUp(t){if(t>0){const e=this.groups[t];this.$set(this.groups,t,this.groups[t-1]),this.$set(this.groups,t-1,e),this.updateValue()}},moveGroupDown(t){if(t<this.groups.length-1){const e=this.groups[t];this.$set(this.groups,t,this.groups[t+1]),this.$set(this.groups,t+1,e),this.updateValue()}},addConditionToGroup(t){const e=this.createDefaultCondition();this.groups[t].conditions.push(e),this.updateValue()},updateCondition(t,e,s){this.$set(this.groups[t].conditions,e,s),this.updateValue()},removeCondition(t,e){this.groups[t].conditions.splice(e,1),this.updateValue()},addNestedGroupToGroup(t){const e={type:"group",...this.createDefaultGroup()};this.groups[t].conditions.push(e),this.updateValue()},addConditionToNestedGroup(t,e){const s=this.createDefaultCondition();this.groups[t].conditions[e].conditions.push(s),this.updateValue()},addNestedGroupToNestedGroup(t,e){const s={type:"group",...this.createDefaultGroup()};this.groups[t].conditions[e].conditions.push(s),this.updateValue()},updateNestedCondition(t,e,s,i){this.$set(this.groups[t].conditions[e].conditions,s,i),this.updateValue()},removeNestedCondition(t,e,s){this.groups[t].conditions[e].conditions.splice(s,1),this.updateValue()},createDefaultCondition(){var i;const t=this.flattenedFields[0],e=((i=this.getOperatorsForField(t)[0])==null?void 0:i.value)||"=";let s="";return(t==null?void 0:t.type)==="date"&&(s={type:"relative",value:"TODAY"}),{attribute:(t==null?void 0:t.value)||"",operator:e,value:s}},updateValue(){const t={groups:this.groups,globalConjunction:this.globalConjunction,limit:this.limit,builderTemplate:this.builderTemplate,sortField:this.sortField,sortDirection:this.sortDirection};this.$emit("input",t)},updateSettingValues(){this.value.limit=parseInt(this.limit)||this.defaultLimit,this.value.builderTemplate=this.builderTemplate||this.defaultBuilderTemplate,this.value.sortField=this.sortField||this.defaultSortField,this.value.sortDirection=this.sortDirection||this.defaultSortDirection}},mounted(){this.groups=this.initializeGroups(),this.limit=this.initializeLimit(),this.sortField=this.initializeSortField(),this.sortDirection=this.initializeSortDirection(),this.builderTemplate=this.initializeBuilderTemplate(),this.fetchPresets()}};var J=function(){var e=this,s=e._self._c;return s("div",{staticClass:"query-builder max-w-4xl mx-auto"},[s("div",{staticClass:"flex items-center justify-between mb-4"},[s("div",{staticClass:"flex flex-col justify-between w-full space-x-4 gap-4"},[s("div",{staticClass:"flex gap-2"},[e.showLimit?s("div",{staticClass:"flex items-center space-x-2"},[s("label",{staticClass:"text-sm",attrs:{for:"limit"}},[e._v(e._s(e.__("Limit results")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.limit,expression:"limit"}],staticClass:"input-text w-24",attrs:{type:"number",name:"limit",id:"limit",min:"1"},domProps:{value:e.limit},on:{input:[function(i){i.target.composing||(e.limit=i.target.value)},e.updateSettingValues]}})]):e._e(),e.builderTemplates?s("div",{staticClass:"flex items-center space-x-2"},[s("label",{staticClass:"text-sm",attrs:{for:"template"}},[e._v(e._s(e.__("Template")))]),s("v-select",{staticClass:"w-36",attrs:{name:"builderTemplate",options:e.builderTemplates,reduce:i=>i.value},on:{input:e.updateSettingValues},model:{value:e.builderTemplate,callback:function(i){e.builderTemplate=i},expression:"builderTemplate"}})],1):e._e()]),s("div",{staticClass:"flex gap-2"},[e.sortFields?s("div",{staticClass:"flex items-center space-x-2"},[s("label",{staticClass:"text-sm",attrs:{for:"template"}},[e._v(e._s(e.__("Sort")))]),s("v-select",{staticClass:"w-36",attrs:{name:"sortField",options:e.sortFields,reduce:i=>i.value},on:{input:e.updateSettingValues},model:{value:e.sortField,callback:function(i){e.sortField=i},expression:"sortField"}})],1):e._e(),e.sortFields?s("div",{staticClass:"flex items-center space-x-2"},[s("label",{staticClass:"text-sm",attrs:{for:"template"}},[e._v(e._s(e.__("Sort Direction")))]),s("v-select",{staticClass:"w-36",attrs:{name:"sortDirection",options:e.sortDirections},on:{input:e.updateSettingValues},model:{value:e.sortDirection,callback:function(i){e.sortDirection=i},expression:"sortDirection"}})],1):e._e()])]),s("div",{staticClass:"flex items-center space-x-2"},[e.groupedPresets.length>0?s("div",{staticClass:"flex items-center space-x-2"},[s("label",{staticClass:"text-sm"},[e._v(e._s(e.__("Presets")))]),s("v-select",{staticClass:"w-48",attrs:{options:e.groupedPresets,reduce:i=>i,label:"name",placeholder:e.__("Select Preset")},on:{input:e.handlePresetSelection},scopedSlots:e._u([{key:"option",fn:function(i){return[i.isHeader?s("div",{staticClass:"font-semibold text-gray-600 px-2 py-1 bg-gray-50 border-b"},[e._v(" "+e._s(i.name)+" ")]):s("div",{staticClass:"px-4 py-2 hover:bg-blue-50"},[s("div",{staticClass:"font-medium"},[e._v(e._s(i.name))]),i.description?s("div",{staticClass:"text-sm text-gray-500 mt-1"},[e._v(" "+e._s(i.description)+" ")]):e._e()])]}}],null,!1,2299860552)})],1):e._e(),s("button",{staticClass:"btn-primary self-start",on:{click:e.addGroup}},[e._v(e._s(e.__("Add Group")))])])]),s("div",{staticClass:"space-y-6"},[e.groups.length>0?s("div",{staticClass:"flex justify-center"},[s("button",{staticClass:"insert-group-btn",attrs:{title:e.__("Insert group here")},on:{click:function(i){return e.insertGroupAt(0)}}},[s("svg",{staticClass:"w-4 h-4",attrs:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"}},[s("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"}})])])]):e._e(),e._l(e.groups,function(i,a){return[s("query-group",{key:`group-${a}`,attrs:{group:i,"group-index":a,fields:e.flattenedFields,operators:e.operators,"display-index":a+1,"can-move-up":a>0,"can-move-down":a<e.groups.length-1,"can-remove":e.groups.length>1},on:{"update-group":e.updateGroup,"remove-group":e.removeGroup,"duplicate-group":e.duplicateGroup,"move-group-up":e.moveGroupUp,"move-group-down":e.moveGroupDown,"add-condition":e.addConditionToGroup,"add-nested-group":e.addNestedGroupToGroup,"add-condition-to-nested":e.addConditionToNestedGroup,"add-nested-group-to-nested":e.addNestedGroupToNestedGroup,"update-condition":e.updateCondition,"update-nested-condition":e.updateNestedCondition,"remove-condition":e.removeCondition,"remove-nested-condition":e.removeNestedCondition}}),a<e.groups.length?s("div",{key:`separator-${a}`,staticClass:"flex flex-col items-center space-y-2"},[s("button",{staticClass:"insert-group-btn",attrs:{title:e.__("Insert group here")},on:{click:function(o){return e.insertGroupAt(a+1)}}},[s("svg",{staticClass:"w-4 h-4",attrs:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"}},[s("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"}})])])]):e._e()]})],2),e.groups.length?e._e():s("div",{staticClass:"text-center py-8 bg-gray-50 rounded-lg"},[s("p",{staticClass:"text-gray-500 mb-4"},[e._v(e._s(e.__('No groups added yet. Click "Add Group" to start building your query.')))])]),e.groups.length>1?s("div",{staticClass:"mt-6 pt-4 border-t border-gray-200"},[s("div",{staticClass:"flex items-center space-x-4"},[s("label",{staticClass:"font-bold"},[e._v(e._s(e.__("Combine Groups with:")))]),s("v-select",{staticClass:"w-32",attrs:{options:e.logicalOperators},on:{input:e.updateValue},model:{value:e.globalConjunction,callback:function(i){e.globalConjunction=i},expression:"globalConjunction"}})],1)]):e._e(),e.showConflictModal?s("div",{staticClass:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},[s("div",{staticClass:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full mx-4"},[s("h3",{staticClass:"text-lg font-semibold mb-4"},[e._v(e._s(e.__("Apply Preset")))]),s("p",{staticClass:"text-gray-600 mb-6"},[e._v(" "+e._s(e.__("You have an existing query. How would you like to apply this preset?"))+" ")]),s("div",{staticClass:"flex space-x-3"},[s("button",{staticClass:"btn flex-1",on:{click:function(i){return e.applyPreset("merge")}}},[e._v(" "+e._s(e.__("Merge"))+" ")]),s("button",{staticClass:"btn-primary flex-1",on:{click:function(i){return e.applyPreset("override")}}},[e._v(" "+e._s(e.__("Override"))+" ")]),s("button",{staticClass:"btn flex-1",on:{click:e.cancelPresetApplication}},[e._v(" "+e._s(e.__("Cancel"))+" ")])])])]):e._e()])},ee=[],te=l(Z,J,ee,!1,null,"8d9d0ddf",null,null);const se=te.exports,ie={components:{QueryBuilder:se},mixins:[Fieldtype],data(){return{attributes:[],groupedFields:[],templates:[{label:"Slider",value:"slider"},{label:"Listing",value:"listing"}],fieldGroups:[{key:"attribute",label:"Attributes",prefix:"attribute."},{key:"stock",label:"Stock",prefix:"",fields:[{label:"Stock Status",value:"stock_status",type:"select",operators:["=","!="],options:[{label:"In Stock",value:"in_stock"},{label:"Out of Stock",value:"out_of_stock"}]}]}]}},methods:{async fetchAttributes(){try{const t=await this.$axios.get("/cp/rapidez/product-attributes");this.attributes=t.data.map(e=>({label:e.frontend_label?e.frontend_label+` (${e.code})`:e.code,value:`attribute.${e.code}`,type:this.mapAttributeType(e.input),options:this.mapAttributeOptions(e.options)})),this.buildGroupedFields()}catch(t){console.error("Error fetching attributes:",t)}},buildGroupedFields(){this.groupedFields=this.fieldGroups.map(t=>t.key==="attribute"?{label:t.label,options:this.attributes}:{label:t.label,options:t.fields.map(e=>({...e,value:t.prefix?`${t.prefix}${e.value}`:e.value}))})},mapAttributeType(t){return{text:"text",textarea:"text",select:"select",multiselect:"select",boolean:"select",price:"number",weight:"number",date:"date",datetime:"date",timestamp:"date"}[t]||"text"},mapAttributeOptions(t){return t.length?(typeof t=="object"&&!Array.isArray(t)&&(t=Object.values(t)),t.map(e=>({label:e.store_value||e.option_id,value:e.option_id}))):[]}},mounted(){this.fetchAttributes()}};var ae=function(){var i;var e=this,s=e._self._c;return s("query-builder",{attrs:{fields:e.groupedFields,"sort-fields":e.attributes,"default-sort-field":(i=e.attributes[0])==null?void 0:i.value,"default-limit":100,"show-limit":!0,"builder-templates":e.templates,"default-builder-template":"slider",value:e.value},on:{input:function(a){return e.$emit("input",a)}}})},oe=[],re=l(ie,ae,oe,!1,null,null,null,null);const ne=re.exports;Statamic.booting(()=>{Statamic.component("product_query_builder-fieldtype",ne)});
