function c(t,e,a,u,i,s,n,l){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=a,r._compiled=!0),u&&(r.functional=!0),s&&(r._scopeId="data-v-"+s);var _;if(n?(_=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),i&&i.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(n)},r._ssrRegister=_):i&&(_=l?function(){i.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:i),_)if(r.functional){r._injectStyles=_;var d=r.render;r.render=function(f,v){return _.call(v),d(f,v)}}else{var p=r.beforeCreate;r.beforeCreate=p?[].concat(p,_):[_]}return{exports:t,options:r}}const m={mixins:[Fieldtype],props:{fields:{type:Array,required:!0,validator:t=>t.every(e=>"label"in e&&"value"in e&&"type"in e)},operators:{type:Object,default:()=>({text:[{value:"=",label:__("Is exactly")},{value:"!=",label:__("Is not")},{value:"LIKE",label:__("Contains")},{value:"NOT LIKE",label:__("Does not contain")},{value:"STARTS_WITH",label:__("Starts with")},{value:"ENDS_WITH",label:__("Ends with")},{value:"IS_NULL",label:__("Is empty")},{value:"IS_NOT_NULL",label:__("Is not empty")}],select:[{value:"=",label:__("Is")},{value:"!=",label:__("Is not")},{value:"IN",label:__("Is any of")},{value:"NOT IN",label:__("Is none of")},{value:"IS_NULL",label:__("Nothing selected")},{value:"IS_NOT_NULL",label:__("Has selection")}],number:[{value:"=",label:__("Equals")},{value:"!=",label:__("Does not equal")},{value:">",label:__("Greater than")},{value:"<",label:__("Less than")},{value:">=",label:__("Greater than or equal to")},{value:"<=",label:__("Less than or equal to")},{value:"BETWEEN",label:__("Is between")},{value:"NOT_BETWEEN",label:__("Is not between")},{value:"IS_NULL",label:__("Is empty")},{value:"IS_NOT_NULL",label:__("Is not empty")}],date:[{value:"=",label:__("Is on")},{value:"!=",label:__("Is not on")},{value:">",label:__("Is after")},{value:"<",label:__("Is before")},{value:">=",label:__("Is on or after")},{value:"<=",label:__("Is on or before")},{value:"BETWEEN",label:__("Is between")},{value:"NOT_BETWEEN",label:__("Is not between")},{value:"LAST_X_DAYS",label:__("In the last days")},{value:"NEXT_X_DAYS",label:__("In the next days")},{value:"THIS_WEEK",label:__("This week")},{value:"THIS_MONTH",label:__("This month")},{value:"THIS_YEAR",label:__("This year")},{value:"IS_NULL",label:__("No date set")},{value:"IS_NOT_NULL",label:__("Has date")}]})},defaultLimit:{type:Number,default:100},showLimit:{type:Boolean,default:!0}},data(){return{groups:[],limit:this.defaultLimit,globalConjunction:"AND",logicalOperators:["AND","OR"]}},methods:{initializeGroups(){var t,e;return(e=(t=this.value)==null?void 0:t.groups)!=null&&e.length?this.value.groups:[{conjunction:"AND",conditions:[]}]},addGroup(){this.groups.push({conjunction:"AND",conditions:[]}),this.updateValue()},removeGroup(t){this.groups.splice(t,1),this.updateValue()},addConditionToGroup(t){var i;const e=this.fields[0],a=((i=this.getOperatorsForType(e==null?void 0:e.value)[0])==null?void 0:i.value)||"=";let u="";(e==null?void 0:e.type)==="date"?u={type:"relative",value:"TODAY"}:this.needsBetweenInput(a)&&(u={min:"",max:""}),this.groups[t].conditions.push({attribute:(e==null?void 0:e.value)||"",operator:a,value:u})},removeCondition(t,e){this.groups[t].conditions.splice(e,1),this.updateValue()},getField(t){return this.fields.find(e=>e.value===t)},getFieldOperators(t){return this.operators[t]||this.operators.text},getFieldOptions(t){const e=this.fields.find(a=>a.value===t);return(e==null?void 0:e.options)||[]},isDateField(t){const e=this.fields.find(a=>a.value===t);return(e==null?void 0:e.type)==="date"},isMultiSelectVisible(t){const e=this.fields.find(a=>a.value===t.attribute);return(e==null?void 0:e.type)==="select"&&["IN","NOT IN"].includes(t.operator)},isSingleSelectVisible(t){const e=this.fields.find(a=>a.value===t.attribute);return(e==null?void 0:e.type)==="select"&&!["IN","NOT IN"].includes(t.operator)},needsValueInput(t){return!["IS_NULL","IS_NOT_NULL","THIS_WEEK","THIS_MONTH","THIS_YEAR"].includes(t)},needsBetweenInput(t){return["BETWEEN","NOT_BETWEEN"].includes(t)},needsDaysInput(t){return["LAST_X_DAYS","NEXT_X_DAYS"].includes(t)},getDateValue(t){(!t.value||typeof t.value=="string")&&this.$set(t,"value",{type:"relative",value:"TODAY"});const e=t.value;if(e.type==="relative"){if(e.value)return{selectedOption:e.value,offset:1,manualDate:""};if(e.base){const a=e.offset>=0?"PLUS":"MINUS";return{selectedOption:`${e.base}_${a}_${e.unit.toUpperCase()}`,offset:Math.abs(e.offset),manualDate:""}}}else if(e.type==="manual")return{selectedOption:"OTHER",offset:1,manualDate:e.value};return{selectedOption:"TODAY",offset:1,manualDate:""}},needsOffsetInput(t){return["TODAY_PLUS_DAYS","TODAY_PLUS_WEEKS","TODAY_PLUS_MONTHS","TODAY_PLUS_YEARS","TODAY_MINUS_DAYS","TODAY_MINUS_WEEKS","TODAY_MINUS_MONTHS","TODAY_MINUS_YEARS"].includes(t)},getOffsetLabel(t){return{TODAY_PLUS_DAYS:__("Days"),TODAY_MINUS_DAYS:__("Days"),TODAY_PLUS_WEEKS:__("Weeks"),TODAY_MINUS_WEEKS:__("Weeks"),TODAY_PLUS_MONTHS:__("Months"),TODAY_MINUS_MONTHS:__("Months"),TODAY_PLUS_YEARS:__("Years"),TODAY_MINUS_YEARS:__("Years")}[t]||""},getDateValueOptions(){return[{value:"TODAY",label:this.__("Today"),group:this.__("Fixed Relatives")},{value:"TOMORROW",label:this.__("Tomorrow"),group:this.__("Fixed Relatives")},{value:"YESTERDAY",label:this.__("Yesterday"),group:this.__("Fixed Relatives")},{value:"TODAY_PLUS_DAYS",label:this.__("Today + X days"),group:this.__("Dynamic Relatives")},{value:"TODAY_PLUS_WEEKS",label:this.__("Today + X weeks"),group:this.__("Dynamic Relatives")},{value:"TODAY_PLUS_MONTHS",label:this.__("Today + X months"),group:this.__("Dynamic Relatives")},{value:"TODAY_PLUS_YEARS",label:this.__("Today + X years"),group:this.__("Dynamic Relatives")},{value:"TODAY_MINUS_DAYS",label:this.__("Today - X days"),group:this.__("Dynamic Relatives")},{value:"TODAY_MINUS_WEEKS",label:this.__("Today - X weeks"),group:this.__("Dynamic Relatives")},{value:"TODAY_MINUS_MONTHS",label:this.__("Today - X months"),group:this.__("Dynamic Relatives")},{value:"TODAY_MINUS_YEARS",label:this.__("Today - X years"),group:this.__("Dynamic Relatives")},{value:"OTHER",label:this.__("Other..."),group:this.__("Manual")}]},onDateOptionChange(t,e,a){const u=this.groups[t].conditions[e];if(["TODAY","TOMORROW","YESTERDAY"].includes(a))u.value={type:"relative",value:a};else if(this.needsOffsetInput(a)){const i=a.split("_"),s=i[0],n=i[1],l=i[2].toLowerCase();u.value={type:"relative",base:s,offset:n==="MINUS"?-1:1,unit:l}}else a==="OTHER"&&(u.value={type:"manual",value:""});this.updateValue()},updateDateOffset(t,e,a){const u=this.groups[t].conditions[e],i=u.value;if(i.type==="relative"&&i.base){const s=i.offset>=0?1:-1;u.value={...i,offset:s*Math.abs(parseInt(a)||1)},this.updateValue()}},updateManualDate(t,e,a){const u=this.groups[t].conditions[e];u.value={type:"manual",value:a},this.updateValue()},getOperatorsForType(t){const e=this.fields.find(a=>a.value===t);return e?this.operators[e.type]||[]:[]},updateCondition(t,e){const a=this.groups[t].conditions[e],u=a.operator;this.needsBetweenInput(u)?a.value={min:"",max:""}:this.needsValueInput(u)?this.isDateField(a.attribute)?a.value={type:"relative",value:"TODAY"}:this.needsDaysInput(u)&&(a.value=a.value||1):a.value=null,this.updateValue()},getBetweenValue(t){return!t.value||typeof t.value=="string"?this.$set(t,"value",{min:"",max:""}):Array.isArray(t.value)&&this.$set(t,"value",{min:t.value[0]||"",max:t.value[1]||""}),t.value},updateBetweenValue(t,e){const a=this.groups[t].conditions[e],u=a.value;a.value=[u.min,u.max],this.updateValue()},updateValue(){this.$emit("input",{groups:this.groups,globalConjunction:this.globalConjunction,limit:parseInt(this.limit)||this.defaultLimit})},moveGroupUp(t){if(t>0){const e=this.groups[t];this.$set(this.groups,t,this.groups[t-1]),this.$set(this.groups,t-1,e),this.updateValue()}},moveGroupDown(t){if(t<this.groups.length-1){const e=this.groups[t];this.$set(this.groups,t,this.groups[t+1]),this.$set(this.groups,t+1,e),this.updateValue()}}},mounted(){this.groups=this.initializeGroups(),this.value&&this.value.limit&&(this.limit=this.value.limit)}};var b=function(){var e=this,a=e._self._c;return a("div",{staticClass:"query-builder max-w-4xl mx-auto"},[a("div",{staticClass:"flex items-center justify-between mb-4"},[a("div",{staticClass:"flex items-center justify-between w-full space-x-4"},[e.showLimit?a("div",{staticClass:"flex items-center space-x-2"},[a("label",{staticClass:"text-sm",attrs:{for:"limit"}},[e._v(e._s(e.__("Limit results")))]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.limit,expression:"limit"}],staticClass:"input-text w-24",attrs:{type:"number",id:"limit",min:"1"},domProps:{value:e.limit},on:{input:[function(u){u.target.composing||(e.limit=u.target.value)},e.updateValue]}})]):e._e(),a("button",{staticClass:"btn-primary",on:{click:e.addGroup}},[e._v(e._s(e.__("Add Group")))])])]),a("div",{staticClass:"space-y-6"},[e._l(e.groups,function(u,i){return a("div",{key:i,staticClass:"border border-gray-300 rounded-lg p-4"},[a("div",{staticClass:"flex items-center justify-between mb-4 pb-2 border-b border-gray-200"},[a("div",{staticClass:"flex items-center space-x-4"},[a("h3",{staticClass:"text-base font-bold"},[e._v(e._s(e.__("Group"))+" "+e._s(i+1))]),a("v-select",{staticClass:"w-32",attrs:{options:e.logicalOperators},on:{input:e.updateValue},model:{value:u.conjunction,callback:function(s){e.$set(u,"conjunction",s)},expression:"group.conjunction"}})],1),a("div",{staticClass:"flex items-center space-x-2"},[a("button",{staticClass:"btn",on:{click:function(s){return e.addConditionToGroup(i)}}},[e._v(e._s(e.__("Add Condition")))]),a("div",{staticClass:"flex items-center space-x-1"},[i>0?a("button",{staticClass:"btn p-2",attrs:{title:e.__("Move group up")},on:{click:function(s){return e.moveGroupUp(i)}}},[e._v(" ↑ ")]):e._e(),i<e.groups.length-1?a("button",{staticClass:"btn p-2",attrs:{title:e.__("Move group down")},on:{click:function(s){return e.moveGroupDown(i)}}},[e._v(" ↓ ")]):e._e()]),a("button",{staticClass:"btn-danger",on:{click:function(s){return e.removeGroup(i)}}},[e._v(e._s(e.__("Remove Group")))])])]),a("div",{staticClass:"space-y-3"},e._l(u.conditions,function(s,n){return a("div",{key:n,staticClass:"flex items-center space-x-4 p-3 rounded-md"},[a("v-select",{staticClass:"w-1/3",attrs:{options:e.fields,reduce:l=>l.value,label:"label",placeholder:e.__("Select Field")},on:{input:function(l){return e.updateCondition(i,n)}},model:{value:s.attribute,callback:function(l){e.$set(s,"attribute",l)},expression:"condition.attribute"}}),a("v-select",{staticClass:"w-1/4",attrs:{options:e.getOperatorsForType(s.attribute),reduce:l=>l.value,label:"label",placeholder:e.__("Select Operator")},on:{input:function(l){return e.updateCondition(i,n)}},model:{value:s.operator,callback:function(l){e.$set(s,"operator",l)},expression:"condition.operator"}}),e.needsValueInput(s.operator)?[e.isMultiSelectVisible(s)?[a("v-select",{staticClass:"flex-1 min-w-0",attrs:{options:e.getFieldOptions(s.attribute),reduce:l=>l.value,label:"label",multiple:"",placeholder:e.__("Select Values")},on:{input:function(l){return e.updateCondition(i,n)}},model:{value:s.value,callback:function(l){e.$set(s,"value",l)},expression:"condition.value"}})]:e.isSingleSelectVisible(s)?[a("v-select",{staticClass:"flex-1 min-w-0",attrs:{options:e.getFieldOptions(s.attribute),reduce:l=>l.value,label:"label",placeholder:e.__("Select Value")},on:{input:function(l){return e.updateCondition(i,n)}},model:{value:s.value,callback:function(l){e.$set(s,"value",l)},expression:"condition.value"}})]:e.needsBetweenInput(s.operator)?[a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.getBetweenValue(s).min,expression:"getBetweenValue(condition).min"}],staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Min value")},domProps:{value:e.getBetweenValue(s).min},on:{input:[function(l){l.target.composing||e.$set(e.getBetweenValue(s),"min",l.target.value)},function(l){return e.updateBetweenValue(i,n)}]}}),a("span",[e._v("and")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.getBetweenValue(s).max,expression:"getBetweenValue(condition).max"}],staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Max value")},domProps:{value:e.getBetweenValue(s).max},on:{input:[function(l){l.target.composing||e.$set(e.getBetweenValue(s),"max",l.target.value)},function(l){return e.updateBetweenValue(i,n)}]}})])]:e.needsDaysInput(s.operator)?[a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("input",{directives:[{name:"model",rawName:"v-model",value:s.value,expression:"condition.value"}],staticClass:"input-text flex-1",attrs:{type:"number",placeholder:e.__("Number of days"),min:"1"},domProps:{value:s.value},on:{input:[function(l){l.target.composing||e.$set(s,"value",l.target.value)},function(l){return e.updateCondition(i,n)}]}}),a("span",[e._v("days")])])]:e.isDateField(s.attribute)?[a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("v-select",{staticClass:"flex-1",attrs:{value:e.getDateValue(s).selectedOption,options:e.getDateValueOptions(),reduce:l=>l.value,label:"label",placeholder:e.__("Select date option")},on:{input:function(l){return e.onDateOptionChange(i,n,l)}}}),e.needsOffsetInput(e.getDateValue(s).selectedOption)?[a("input",{staticClass:"input-text w-20",attrs:{type:"number",placeholder:1,min:"1"},domProps:{value:e.getDateValue(s).offset},on:{input:function(l){return e.updateDateOffset(i,n,l.target.value)}}}),a("span",{staticClass:"text-sm font-medium text-gray-600"},[e._v(" "+e._s(e.getOffsetLabel(e.getDateValue(s).selectedOption))+" ")])]:e._e(),e.getDateValue(s).selectedOption==="OTHER"?a("input",{staticClass:"input-text flex-1",attrs:{type:"date"},domProps:{value:e.getDateValue(s).manualDate},on:{input:function(l){return e.updateManualDate(i,n,l.target.value)}}}):e._e()],2)]:[a("input",{directives:[{name:"model",rawName:"v-model",value:s.value,expression:"condition.value"}],staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Enter value")},domProps:{value:s.value},on:{input:[function(l){l.target.composing||e.$set(s,"value",l.target.value)},function(l){return e.updateCondition(i,n)}]}})]]:e._e(),a("button",{staticClass:"btn-danger",attrs:{title:"Remove condition"},on:{click:function(l){return e.removeCondition(i,n)}}},[e._v(" × ")])],2)}),0)])}),e.groups.length?e._e():a("div",{staticClass:"text-center py-8 bg-gray-50 rounded-lg"},[a("p",{staticClass:"text-gray-500 mb-4"},[e._v(e._s(e.__('No groups added yet. Click "Add Group" to start building your query.')))])])],2),e.groups.length>1?a("div",{staticClass:"mt-6 pt-4 border-t border-gray-200"},[a("div",{staticClass:"flex items-center space-x-4"},[a("label",{staticClass:"font-bold"},[e._v(e._s(e.__("Combine Groups with:")))]),a("v-select",{staticClass:"w-32",attrs:{options:e.logicalOperators},on:{input:e.updateValue},model:{value:e.globalConjunction,callback:function(u){e.globalConjunction=u},expression:"globalConjunction"}})],1)]):e._e()])},h=[],y=c(m,b,h,!1,null,"fb82e9ac",null,null);const g=y.exports,T={components:{QueryBuilder:g},mixins:[Fieldtype],data(){return{attributes:[]}},methods:{async fetchAttributes(){try{const t=await this.$axios.get("/cp/rapidez/product-attributes");this.attributes=t.data.map(e=>({label:e.store_frontend_label?e.store_frontend_label+` (${e.attribute_code})`:e.attribute_code,value:e.attribute_code,type:this.mapAttributeType(e.frontend_input),options:this.mapAttributeOptions(e.attribute_options)}))}catch(t){console.error("Error fetching attributes:",t)}},mapAttributeType(t){return{text:"text",textarea:"text",select:"select",multiselect:"select",boolean:"select",price:"number",weight:"number",date:"date",datetime:"date",timestamp:"date"}[t]||"text"},mapAttributeOptions(t){return t.length?(typeof t=="object"&&!Array.isArray(t)&&(t=Object.values(t)),t.map(e=>({label:e.store_value||e.option_id,value:e.option_id}))):[]}},mounted(){this.fetchAttributes()}};var O=function(){var e=this,a=e._self._c;return a("query-builder",{attrs:{fields:e.attributes,"default-limit":100,"show-limit":!0},model:{value:e.value,callback:function(u){e.value=u},expression:"value"}})},S=[],D=c(T,O,S,!1,null,null,null,null);const C=D.exports;Statamic.booting(()=>{Statamic.component("product_query_builder-fieldtype",C)});
