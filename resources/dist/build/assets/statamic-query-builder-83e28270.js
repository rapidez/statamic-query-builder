function d(t,e,a,u,i,l,n,s){var r=typeof t=="function"?t.options:t;e&&(r.render=e,r.staticRenderFns=a,r._compiled=!0),u&&(r.functional=!0),l&&(r._scopeId="data-v-"+l);var p;if(n?(p=function(o){o=o||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!o&&typeof __VUE_SSR_CONTEXT__<"u"&&(o=__VUE_SSR_CONTEXT__),i&&i.call(this,o),o&&o._registeredComponents&&o._registeredComponents.add(n)},r._ssrRegister=p):i&&(p=s?function(){i.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:i),p)if(r.functional){r._injectStyles=p;var m=r.render;r.render=function(b,v){return p.call(v),m(b,v)}}else{var c=r.beforeCreate;r.beforeCreate=c?[].concat(c,p):[p]}return{exports:t,options:r}}const f={mixins:[Fieldtype],props:{fields:{type:Array,required:!0,validator:t=>t.every(e=>"label"in e&&"value"in e&&"type"in e)},operators:{type:Object,default:()=>({text:[{value:"=",label:"Is exactly"},{value:"!=",label:"Is not"},{value:"LIKE",label:"Contains"},{value:"NOT LIKE",label:"Does not contain"},{value:"STARTS_WITH",label:"Starts with"},{value:"ENDS_WITH",label:"Ends with"},{value:"IS_NULL",label:"Is empty"},{value:"IS_NOT_NULL",label:"Is not empty"}],select:[{value:"=",label:"Is"},{value:"!=",label:"Is not"},{value:"IN",label:"Is any of"},{value:"NOT IN",label:"Is none of"},{value:"IS_NULL",label:"Nothing selected"},{value:"IS_NOT_NULL",label:"Has selection"}],number:[{value:"=",label:"Equals"},{value:"!=",label:"Does not equal"},{value:">",label:"Greater than"},{value:"<",label:"Less than"},{value:">=",label:"Greater than or equal to"},{value:"<=",label:"Less than or equal to"},{value:"BETWEEN",label:"Is between"},{value:"NOT_BETWEEN",label:"Is not between"},{value:"IS_NULL",label:"Is empty"},{value:"IS_NOT_NULL",label:"Is not empty"}],date:[{value:"=",label:"Is on"},{value:"!=",label:"Is not on"},{value:">",label:"Is after"},{value:"<",label:"Is before"},{value:">=",label:"Is on or after"},{value:"<=",label:"Is on or before"},{value:"BETWEEN",label:"Is between"},{value:"NOT_BETWEEN",label:"Is not between"},{value:"LAST_X_DAYS",label:"In the last days"},{value:"NEXT_X_DAYS",label:"In the next days"},{value:"THIS_WEEK",label:"This week"},{value:"THIS_MONTH",label:"This month"},{value:"THIS_YEAR",label:"This year"},{value:"IS_NULL",label:"No date set"},{value:"IS_NOT_NULL",label:"Has date"}]})},defaultLimit:{type:Number,default:100},showLimit:{type:Boolean,default:!0}},data(){return{groups:[],limit:this.defaultLimit,globalConjunction:"AND",logicalOperators:["AND","OR"]}},methods:{initializeGroups(){var t,e;return(e=(t=this.value)==null?void 0:t.groups)!=null&&e.length?this.value.groups:[{conjunction:"AND",conditions:[]}]},addGroup(){this.groups.push({conjunction:"AND",conditions:[]}),this.updateValue()},removeGroup(t){this.groups.splice(t,1),this.updateValue()},addConditionToGroup(t){var u,i,l;const e=((i=this.getOperatorsForType((u=this.fields[0])==null?void 0:u.value)[0])==null?void 0:i.value)||"=",a=this.needsBetweenInput(e)?{min:"",max:""}:"";this.groups[t].conditions.push({attribute:((l=this.fields[0])==null?void 0:l.value)||"",operator:e,value:a})},removeCondition(t,e){this.groups[t].conditions.splice(e,1),this.updateValue()},getField(t){return this.fields.find(e=>e.value===t)},getFieldOperators(t){return this.operators[t]||this.operators.text},getFieldOptions(t){const e=this.fields.find(a=>a.value===t);return(e==null?void 0:e.options)||[]},isMultiSelectVisible(t){const e=this.fields.find(a=>a.value===t.attribute);return(e==null?void 0:e.type)==="select"&&["IN","NOT IN"].includes(t.operator)},isSingleSelectVisible(t){const e=this.fields.find(a=>a.value===t.attribute);return(e==null?void 0:e.type)==="select"&&!["IN","NOT IN"].includes(t.operator)},needsValueInput(t){return!["IS_NULL","IS_NOT_NULL","THIS_WEEK","THIS_MONTH","THIS_YEAR"].includes(t)},needsBetweenInput(t){return["BETWEEN","NOT_BETWEEN"].includes(t)},needsDaysInput(t){return["LAST_X_DAYS","NEXT_X_DAYS"].includes(t)},getOperatorsForType(t){const e=this.fields.find(a=>a.value===t);return e?this.operators[e.type]||[]:[]},updateCondition(t,e){const a=this.groups[t].conditions[e],u=a.operator;this.needsBetweenInput(u)?a.value={min:"",max:""}:this.needsValueInput(u)||(a.value=null),this.updateValue()},getBetweenValue(t){return!t.value||typeof t.value=="string"?this.$set(t,"value",{min:"",max:""}):Array.isArray(t.value)&&this.$set(t,"value",{min:t.value[0]||"",max:t.value[1]||""}),t.value},updateBetweenValue(t,e){const a=this.groups[t].conditions[e],u=a.value;a.value=[u.min,u.max],this.updateValue()},updateValue(){this.$emit("input",{groups:this.groups,globalConjunction:this.globalConjunction,limit:parseInt(this.limit)||this.defaultLimit})},moveGroupUp(t){if(t>0){const e=this.groups[t];this.$set(this.groups,t,this.groups[t-1]),this.$set(this.groups,t-1,e),this.updateValue()}},moveGroupDown(t){if(t<this.groups.length-1){const e=this.groups[t];this.$set(this.groups,t,this.groups[t+1]),this.$set(this.groups,t+1,e),this.updateValue()}}},mounted(){this.groups=this.initializeGroups(),this.value&&this.value.limit&&(this.limit=this.value.limit)}};var h=function(){var e=this,a=e._self._c;return a("div",{staticClass:"query-builder max-w-4xl mx-auto"},[a("div",{staticClass:"flex items-center justify-between mb-4"},[a("div",{staticClass:"flex items-center justify-between w-full space-x-4"},[e.showLimit?a("div",{staticClass:"flex items-center space-x-2"},[a("label",{staticClass:"text-sm",attrs:{for:"limit"}},[e._v("Limit results:")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.limit,expression:"limit"}],staticClass:"input-text w-24",attrs:{type:"number",id:"limit",min:"1"},domProps:{value:e.limit},on:{input:[function(u){u.target.composing||(e.limit=u.target.value)},e.updateValue]}})]):e._e(),a("button",{staticClass:"btn-primary",on:{click:e.addGroup}},[e._v("Add Group")])])]),a("div",{staticClass:"space-y-6"},[e._l(e.groups,function(u,i){return a("div",{key:i,staticClass:"border border-gray-300 rounded-lg p-4"},[a("div",{staticClass:"flex items-center justify-between mb-4 pb-2 border-b border-gray-200"},[a("div",{staticClass:"flex items-center space-x-4"},[a("h3",{staticClass:"text-base font-bold"},[e._v("Group "+e._s(i+1))]),a("v-select",{staticClass:"w-32",attrs:{options:e.logicalOperators},on:{input:e.updateValue},model:{value:u.conjunction,callback:function(l){e.$set(u,"conjunction",l)},expression:"group.conjunction"}})],1),a("div",{staticClass:"flex items-center space-x-2"},[a("button",{staticClass:"btn",on:{click:function(l){return e.addConditionToGroup(i)}}},[e._v("Add Condition")]),a("div",{staticClass:"flex items-center space-x-1"},[i>0?a("button",{staticClass:"btn p-2",attrs:{title:"Move group up"},on:{click:function(l){return e.moveGroupUp(i)}}},[e._v(" ↑ ")]):e._e(),i<e.groups.length-1?a("button",{staticClass:"btn p-2",attrs:{title:"Move group down"},on:{click:function(l){return e.moveGroupDown(i)}}},[e._v(" ↓ ")]):e._e()]),a("button",{staticClass:"btn-danger",on:{click:function(l){return e.removeGroup(i)}}},[e._v("Remove Group")])])]),a("div",{staticClass:"space-y-3"},e._l(u.conditions,function(l,n){return a("div",{key:n,staticClass:"flex items-center space-x-4 p-3 rounded-md"},[a("v-select",{staticClass:"w-1/3",attrs:{options:e.fields,reduce:s=>s.value,label:"label",placeholder:"Select Field"},on:{input:function(s){return e.updateCondition(i,n)}},model:{value:l.attribute,callback:function(s){e.$set(l,"attribute",s)},expression:"condition.attribute"}}),a("v-select",{staticClass:"w-1/4",attrs:{options:e.getOperatorsForType(l.attribute),reduce:s=>s.value,label:"label",placeholder:"Select Operator"},on:{input:function(s){return e.updateCondition(i,n)}},model:{value:l.operator,callback:function(s){e.$set(l,"operator",s)},expression:"condition.operator"}}),e.needsValueInput(l.operator)?[e.isMultiSelectVisible(l)?[a("v-select",{staticClass:"flex-1 min-w-0",attrs:{options:e.getFieldOptions(l.attribute),reduce:s=>s.value,label:"label",multiple:"",placeholder:"Select Values"},on:{input:function(s){return e.updateCondition(i,n)}},model:{value:l.value,callback:function(s){e.$set(l,"value",s)},expression:"condition.value"}})]:e.isSingleSelectVisible(l)?[a("v-select",{staticClass:"flex-1 min-w-0",attrs:{options:e.getFieldOptions(l.attribute),reduce:s=>s.value,label:"label",placeholder:"Select Value"},on:{input:function(s){return e.updateCondition(i,n)}},model:{value:l.value,callback:function(s){e.$set(l,"value",s)},expression:"condition.value"}})]:e.needsBetweenInput(l.operator)?[a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.getBetweenValue(l).min,expression:"getBetweenValue(condition).min"}],staticClass:"input-text flex-1",attrs:{type:"text",placeholder:"Min value"},domProps:{value:e.getBetweenValue(l).min},on:{input:[function(s){s.target.composing||e.$set(e.getBetweenValue(l),"min",s.target.value)},function(s){return e.updateBetweenValue(i,n)}]}}),a("span",[e._v("and")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.getBetweenValue(l).max,expression:"getBetweenValue(condition).max"}],staticClass:"input-text flex-1",attrs:{type:"text",placeholder:"Max value"},domProps:{value:e.getBetweenValue(l).max},on:{input:[function(s){s.target.composing||e.$set(e.getBetweenValue(l),"max",s.target.value)},function(s){return e.updateBetweenValue(i,n)}]}})])]:e.needsDaysInput(l.operator)?[a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("input",{directives:[{name:"model",rawName:"v-model",value:l.value,expression:"condition.value"}],staticClass:"input-text flex-1",attrs:{type:"number",placeholder:"Number of days",min:"1"},domProps:{value:l.value},on:{input:[function(s){s.target.composing||e.$set(l,"value",s.target.value)},function(s){return e.updateCondition(i,n)}]}}),a("span",[e._v("days")])])]:[a("input",{directives:[{name:"model",rawName:"v-model",value:l.value,expression:"condition.value"}],staticClass:"input-text flex-1",attrs:{type:"text",placeholder:"Enter value"},domProps:{value:l.value},on:{input:[function(s){s.target.composing||e.$set(l,"value",s.target.value)},function(s){return e.updateCondition(i,n)}]}})]]:e._e(),a("button",{staticClass:"btn-danger",attrs:{title:"Remove condition"},on:{click:function(s){return e.removeCondition(i,n)}}},[e._v(" × ")])],2)}),0)])}),e.groups.length?e._e():a("div",{staticClass:"text-center py-8 bg-gray-50 rounded-lg"},[a("p",{staticClass:"text-gray-500 mb-4"},[e._v('No groups added yet. Click "Add Group" to start building your query.')])])],2),e.groups.length>1?a("div",{staticClass:"mt-6 pt-4 border-t border-gray-200"},[a("div",{staticClass:"flex items-center space-x-4"},[a("label",{staticClass:"font-bold"},[e._v("Combine Groups with:")]),a("v-select",{staticClass:"w-32",attrs:{options:e.logicalOperators},on:{input:e.updateValue},model:{value:e.globalConjunction,callback:function(u){e.globalConjunction=u},expression:"globalConjunction"}})],1)]):e._e()])},_=[],g=d(f,h,_,!1,null,null,null,null);const y=g.exports,C={components:{QueryBuilder:y},mixins:[Fieldtype],data(){return{attributes:[]}},methods:{async fetchAttributes(){try{const t=await this.$axios.get("/cp/rapidez/product-attributes");this.attributes=t.data.map(e=>({label:e.store_frontend_label?e.store_frontend_label+` (${e.attribute_code})`:e.attribute_code,value:e.attribute_code,type:this.mapAttributeType(e.frontend_input),options:this.mapAttributeOptions(e.attribute_options)}))}catch(t){console.error("Error fetching attributes:",t)}},mapAttributeType(t){return{text:"text",textarea:"text",select:"select",multiselect:"select",boolean:"select",price:"number",weight:"number",date:"date",datetime:"date",timestamp:"date"}[t]||"text"},mapAttributeOptions(t){return t.length?(typeof t=="object"&&!Array.isArray(t)&&(t=Object.values(t)),t.map(e=>({label:e.store_value||e.option_id,value:e.option_id}))):[]}},mounted(){this.fetchAttributes()}};var N=function(){var e=this,a=e._self._c;return a("query-builder",{attrs:{fields:e.attributes,"default-limit":100,"show-limit":!0},on:{input:function(u){return e.$emit("input",u)}},model:{value:e.value,callback:function(u){e.value=u},expression:"value"}})},w=[],T=d(C,N,w,!1,null,null,null,null);const S=T.exports;Statamic.booting(()=>{Statamic.component("product_query_builder-fieldtype",S)});
