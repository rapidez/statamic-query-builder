function r(t,e,a,n,s,u,p,v){var i=typeof t=="function"?t.options:t;e&&(i.render=e,i.staticRenderFns=a,i._compiled=!0),n&&(i.functional=!0),u&&(i._scopeId="data-v-"+u);var o;if(p?(o=function(l){l=l||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!l&&typeof __VUE_SSR_CONTEXT__<"u"&&(l=__VUE_SSR_CONTEXT__),s&&s.call(this,l),l&&l._registeredComponents&&l._registeredComponents.add(p)},i._ssrRegister=o):s&&(o=v?function(){s.call(this,(i.functional?this.parent:this).$root.$options.shadowRoot)}:s),o)if(i.functional){i._injectStyles=o;var f=i.render;i.render=function(h,c){return o.call(c),f(h,c)}}else{var _=i.beforeCreate;i.beforeCreate=_?[].concat(_,o):[o]}return{exports:t,options:i}}const m={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}},methods:{getDateValue(){const t=this.condition.value;if(!t||typeof t=="string")return{selectedOption:"TODAY",offset:1,manualDate:""};if(t.type==="relative"){if(t.value)return{selectedOption:t.value,offset:1,manualDate:""};if(t.base){const e=t.offset>=0?"PLUS":"MINUS";return{selectedOption:`${t.base}_${e}_${t.unit.toUpperCase()}`,offset:Math.abs(t.offset),manualDate:""}}}else if(t.type==="manual")return{selectedOption:"OTHER",offset:1,manualDate:t.value};return{selectedOption:"TODAY",offset:1,manualDate:""}},getDateValueOptions(){return[{value:"TODAY",label:this.__("Today")},{value:"TOMORROW",label:this.__("Tomorrow")},{value:"YESTERDAY",label:this.__("Yesterday")},{value:"TODAY_PLUS_DAYS",label:this.__("Today + X days")},{value:"TODAY_PLUS_WEEKS",label:this.__("Today + X weeks")},{value:"TODAY_PLUS_MONTHS",label:this.__("Today + X months")},{value:"TODAY_PLUS_YEARS",label:this.__("Today + X years")},{value:"TODAY_MINUS_DAYS",label:this.__("Today - X days")},{value:"TODAY_MINUS_WEEKS",label:this.__("Today - X weeks")},{value:"TODAY_MINUS_MONTHS",label:this.__("Today - X months")},{value:"TODAY_MINUS_YEARS",label:this.__("Today - X years")},{value:"OTHER",label:this.__("Other...")}]},needsOffsetInput(t){return["TODAY_PLUS_DAYS","TODAY_PLUS_WEEKS","TODAY_PLUS_MONTHS","TODAY_PLUS_YEARS","TODAY_MINUS_DAYS","TODAY_MINUS_WEEKS","TODAY_MINUS_MONTHS","TODAY_MINUS_YEARS"].includes(t)},getOffsetLabel(t){return{TODAY_PLUS_DAYS:this.__("Days"),TODAY_MINUS_DAYS:this.__("Days"),TODAY_PLUS_WEEKS:this.__("Weeks"),TODAY_MINUS_WEEKS:this.__("Weeks"),TODAY_PLUS_MONTHS:this.__("Months"),TODAY_MINUS_MONTHS:this.__("Months"),TODAY_PLUS_YEARS:this.__("Years"),TODAY_MINUS_YEARS:this.__("Years")}[t]||""},onDateOptionChange(t){if(["TODAY","TOMORROW","YESTERDAY"].includes(t))this.$emit("update-value",{type:"relative",value:t});else if(this.needsOffsetInput(t)){const e=t.split("_"),a=e[0],n=e[1],s=e[2].toLowerCase();this.$emit("update-value",{type:"relative",base:a,offset:n==="MINUS"?-1:1,unit:s})}else t==="OTHER"&&this.$emit("update-value",{type:"manual",value:""})},updateDateOffset(t){const e=this.condition.value;if(e.type==="relative"&&e.base){const a=e.offset>=0?1:-1;this.$emit("update-value",{...e,offset:a*Math.abs(parseInt(t)||1)})}},updateManualDate(t){this.$emit("update-value",{type:"manual",value:t})}}};var b=function(){var e=this,a=e._self._c;return a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("v-select",{staticClass:"flex-1",attrs:{value:e.getDateValue().selectedOption,options:e.getDateValueOptions(),reduce:n=>n.value,label:"label",placeholder:e.__("Select date option")},on:{input:e.onDateOptionChange}}),e.needsOffsetInput(e.getDateValue().selectedOption)?[a("input",{staticClass:"input-text w-20",attrs:{type:"number",placeholder:1,min:"1"},domProps:{value:e.getDateValue().offset},on:{input:function(n){return e.updateDateOffset(n.target.value)}}}),a("span",{staticClass:"text-sm font-medium text-gray-600"},[e._v(" "+e._s(e.getOffsetLabel(e.getDateValue().selectedOption))+" ")])]:e._e(),e.getDateValue().selectedOption==="OTHER"?a("input",{staticClass:"input-text flex-1",attrs:{type:"date"},domProps:{value:e.getDateValue().manualDate},on:{input:function(n){return e.updateManualDate(n.target.value)}}}):e._e()],2)},g=[],y=r(m,b,g,!1,null,null,null,null);const O=y.exports,T={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}},computed:{isMultiSelect(){var t;return((t=this.field)==null?void 0:t.type)==="select"&&["IN","NOT IN"].includes(this.condition.operator)}}};var S=function(){var e=this,a=e._self._c;return a("div",{staticClass:"flex-1 min-w-0"},[e.isMultiSelect?a("v-select",{attrs:{value:e.condition.value,options:e.field.options||[],reduce:n=>n.value,label:"label",multiple:"",placeholder:e.__("Select Values")},on:{input:function(n){return e.$emit("update-value",n)}}}):a("v-select",{attrs:{value:e.condition.value,options:e.field.options||[],reduce:n=>n.value,label:"label",placeholder:e.__("Select Value")},on:{input:function(n){return e.$emit("update-value",n)}}})],1)},C=[],I=r(T,S,C,!1,null,null,null,null);const D=I.exports,x={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}},methods:{getBetweenValue(){const t=this.condition.value;return!t||typeof t=="string"?{min:"",max:""}:Array.isArray(t)?{min:t[0]||"",max:t[1]||""}:t},updateMin(t){const e=this.getBetweenValue();this.$emit("update-value",[t,e.max])},updateMax(t){const e=this.getBetweenValue();this.$emit("update-value",[e.min,t])}}};var A=function(){var e=this,a=e._self._c;return a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("input",{staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Min value")},domProps:{value:e.getBetweenValue().min},on:{input:function(n){return e.updateMin(n.target.value)}}}),a("span",[e._v(e._s(e.__("and")))]),a("input",{staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Max value")},domProps:{value:e.getBetweenValue().max},on:{input:function(n){return e.updateMax(n.target.value)}}})])},$=[],N=r(x,A,$,!1,null,null,null,null);const E=N.exports,V={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}}};var w=function(){var e=this,a=e._self._c;return a("div",{staticClass:"flex items-center space-x-2 flex-1"},[a("input",{staticClass:"input-text flex-1",attrs:{type:"number",placeholder:e.__("Number of days"),min:"1"},domProps:{value:e.condition.value},on:{input:function(n){e.$emit("update-value",parseInt(n.target.value)||1)}}}),a("span",[e._v(e._s(e.__("days")))])])},Y=[],M=r(V,w,Y,!1,null,null,null,null);const L=M.exports,U={props:{condition:{type:Object,required:!0},field:{type:Object,required:!0}}};var R=function(){var e=this,a=e._self._c;return a("input",{staticClass:"input-text flex-1",attrs:{type:"text",placeholder:e.__("Enter value")},domProps:{value:e.condition.value},on:{input:function(n){return e.$emit("update-value",n.target.value)}}})},j=[],q=r(U,R,j,!1,null,null,null,null);const k=q.exports,d={methods:{getField(t){return this.fields.find(e=>e.value===t)},getFieldOperators(t){return this.operators[t]||this.operators.text},getFieldOptions(t){const e=this.fields.find(a=>a.value===t);return(e==null?void 0:e.options)||[]},isDateField(t){const e=this.fields.find(a=>a.value===t);return(e==null?void 0:e.type)==="date"},isMultiSelectVisible(t){const e=this.fields.find(a=>a.value===(t==null?void 0:t.attribute));return(e==null?void 0:e.type)==="select"&&["IN","NOT IN"].includes(t==null?void 0:t.operator)},isSingleSelectVisible(t){const e=this.fields.find(a=>a.value===(t==null?void 0:t.attribute));return(e==null?void 0:e.type)==="select"&&!["IN","NOT IN"].includes(t==null?void 0:t.operator)},needsValueInput(t){return!["IS_NULL","IS_NOT_NULL","THIS_WEEK","THIS_MONTH","THIS_YEAR"].includes(t)},needsBetweenInput(t){return["BETWEEN","NOT_BETWEEN"].includes(t)},needsDaysInput(t){return["LAST_X_DAYS","NEXT_X_DAYS"].includes(t)},getOperatorsForType(t){const e=this.fields.find(a=>a.value===t);return e?this.operators[e.type]||[]:[]},initializeGroups(){var t,e;return(e=(t=this.value)==null?void 0:t.groups)!=null&&e.length?this.value.groups:[{conjunction:"AND",conditions:[]}]}}},G={components:{DateValueInput:O,SelectValueInput:D,BetweenValueInput:E,DaysValueInput:L,TextValueInput:k},mixins:[d],props:{condition:{type:Object,required:!0},conditionIndex:{type:Number,required:!0},groupIndex:{type:Number,required:!0},fields:{type:Array,required:!0},operators:{type:Object,required:!0}},methods:{getValueInputComponent(){return this.isMultiSelectVisible(this.condition)||this.isSingleSelectVisible(this.condition)?"SelectValueInput":this.needsBetweenInput(this.condition.operator)?"BetweenValueInput":this.needsDaysInput(this.condition.operator)?"DaysValueInput":this.isDateField(this.condition.attribute)?"DateValueInput":"TextValueInput"},getCurrentField(){return this.fields.find(t=>t.value===this.condition.attribute)},updateAttribute(t){var a;const e={...this.condition,attribute:t,operator:((a=this.getOperatorsForType(t)[0])==null?void 0:a.value)||"=",value:this.getDefaultValueForField(t)};this.$emit("update-condition",this.conditionIndex,e)},updateOperator(t){const e={...this.condition,operator:t,value:this.getDefaultValueForOperator(t)};this.$emit("update-condition",this.conditionIndex,e)},updateValue(t){const e={...this.condition,value:t};this.$emit("update-condition",this.conditionIndex,e)},getDefaultValueForField(t){const e=this.fields.find(a=>a.value===t);return(e==null?void 0:e.type)==="date"?{type:"relative",value:"TODAY"}:""},getDefaultValueForOperator(t){return this.needsBetweenInput(t)?{min:"",max:""}:this.needsValueInput(t)?this.condition.value:null}}};var F=function(){var e=this,a=e._self._c;return a("div",{staticClass:"flex items-center space-x-4 p-3 rounded-md"},[a("v-select",{staticClass:"w-1/3",attrs:{value:e.condition.attribute,options:e.fields,reduce:n=>n.value,label:"label",placeholder:e.__("Select Field")},on:{input:e.updateAttribute}}),a("v-select",{staticClass:"w-1/4",attrs:{value:e.condition.operator,options:e.getOperatorsForType(e.condition.attribute),reduce:n=>n.value,label:"label",placeholder:e.__("Select Operator")},on:{input:e.updateOperator}}),e.needsValueInput(e.condition.operator)?[a(e.getValueInputComponent(),{tag:"component",attrs:{condition:e.condition,field:e.getCurrentField()},on:{"update-value":e.updateValue}})]:e._e(),a("button",{staticClass:"btn-danger",attrs:{title:"Remove condition"},on:{click:function(n){return e.$emit("remove-condition",e.conditionIndex)}}},[e._v(" × ")])],2)},B=[],H=r(G,F,B,!1,null,null,null,null);const P=H.exports,W={components:{QueryCondition:P},props:{group:{type:Object,required:!0},groupIndex:{type:Number,required:!0},fields:{type:Array,required:!0},operators:{type:Object,required:!0},canMoveUp:{type:Boolean,default:!1},canMoveDown:{type:Boolean,default:!1},canRemove:{type:Boolean,default:!0}},data(){return{logicalOperators:["AND","OR"]}},methods:{updateConjunction(t){const e={...this.group,conjunction:t};this.$emit("update-group",this.groupIndex,e)},updateCondition(t,e){this.$emit("update-condition",this.groupIndex,t,e)},removeCondition(t){this.$emit("remove-condition",this.groupIndex,t)}}};var X=function(){var e=this,a=e._self._c;return a("div",{staticClass:"border border-gray-300 rounded-lg p-4"},[a("div",{staticClass:"flex items-center justify-between mb-4 pb-2 border-b border-gray-200"},[a("div",{staticClass:"flex items-center space-x-4"},[a("h3",{staticClass:"text-base font-bold"},[e._v(e._s(e.__("Group"))+" "+e._s(e.groupIndex+1))]),a("v-select",{staticClass:"w-32",attrs:{value:e.group.conjunction,options:e.logicalOperators},on:{input:e.updateConjunction}})],1),a("div",{staticClass:"flex items-center space-x-2"},[a("button",{staticClass:"btn",on:{click:function(n){return e.$emit("add-condition",e.groupIndex)}}},[e._v(" "+e._s(e.__("Add Condition"))+" ")]),a("div",{staticClass:"flex items-center space-x-1"},[e.canMoveUp?a("button",{staticClass:"btn p-2",attrs:{title:e.__("Move group up")},on:{click:function(n){return e.$emit("move-group-up",e.groupIndex)}}},[e._v(" ↑ ")]):e._e(),e.canMoveDown?a("button",{staticClass:"btn p-2",attrs:{title:e.__("Move group down")},on:{click:function(n){return e.$emit("move-group-down",e.groupIndex)}}},[e._v(" ↓ ")]):e._e()]),e.canRemove?a("button",{staticClass:"btn-danger",on:{click:function(n){return e.$emit("remove-group",e.groupIndex)}}},[e._v(" "+e._s(e.__("Remove Group"))+" ")]):e._e()])]),a("div",{staticClass:"space-y-3"},e._l(e.group.conditions,function(n,s){return a("query-condition",{key:s,attrs:{condition:n,"condition-index":s,"group-index":e.groupIndex,fields:e.fields,operators:e.operators},on:{"update-condition":e.updateCondition,"remove-condition":e.removeCondition}})}),1)])},K=[],Q=r(W,X,K,!1,null,null,null,null);const z=Q.exports;const J={components:{QueryGroup:z},mixins:[Fieldtype,d],props:{fields:{type:Array,required:!0,validator:t=>t.every(e=>"label"in e&&"value"in e&&"type"in e)},operators:{type:Object,default:()=>({text:[{value:"=",label:__("Is exactly")},{value:"!=",label:__("Is not")},{value:"LIKE",label:__("Contains")},{value:"NOT LIKE",label:__("Does not contain")},{value:"STARTS_WITH",label:__("Starts with")},{value:"ENDS_WITH",label:__("Ends with")},{value:"IS_NULL",label:__("Is empty")},{value:"IS_NOT_NULL",label:__("Is not empty")}],select:[{value:"=",label:__("Is")},{value:"!=",label:__("Is not")},{value:"IN",label:__("Is any of")},{value:"NOT IN",label:__("Is none of")},{value:"IS_NULL",label:__("Nothing selected")},{value:"IS_NOT_NULL",label:__("Has selection")}],number:[{value:"=",label:__("Equals")},{value:"!=",label:__("Does not equal")},{value:">",label:__("Greater than")},{value:"<",label:__("Less than")},{value:">=",label:__("Greater than or equal to")},{value:"<=",label:__("Less than or equal to")},{value:"BETWEEN",label:__("Is between")},{value:"NOT_BETWEEN",label:__("Is not between")},{value:"IS_NULL",label:__("Is empty")},{value:"IS_NOT_NULL",label:__("Is not empty")}],date:[{value:"=",label:__("Is on")},{value:"!=",label:__("Is not on")},{value:">",label:__("Is after")},{value:"<",label:__("Is before")},{value:">=",label:__("Is on or after")},{value:"<=",label:__("Is on or before")},{value:"BETWEEN",label:__("Is between")},{value:"NOT_BETWEEN",label:__("Is not between")},{value:"LAST_X_DAYS",label:__("In the last days")},{value:"NEXT_X_DAYS",label:__("In the next days")},{value:"THIS_WEEK",label:__("This week")},{value:"THIS_MONTH",label:__("This month")},{value:"THIS_YEAR",label:__("This year")},{value:"IS_NULL",label:__("No date set")},{value:"IS_NOT_NULL",label:__("Has date")}]})},defaultLimit:{type:Number,default:100},showLimit:{type:Boolean,default:!0}},data(){return{groups:[],limit:this.defaultLimit,globalConjunction:"AND",logicalOperators:["AND","OR"]}},methods:{addGroup(){this.groups.push({conjunction:"AND",conditions:[]}),this.updateValue()},insertGroupAt(t){const e={conjunction:"AND",conditions:[]};this.groups.splice(t,0,e),this.updateValue()},removeGroup(t){this.groups.splice(t,1),this.updateValue()},updateGroup(t,e){this.$set(this.groups,t,e),this.updateValue()},addConditionToGroup(t){const e=this.createDefaultCondition();this.groups[t].conditions.push(e),this.updateValue()},updateCondition(t,e,a){this.$set(this.groups[t].conditions,e,a),this.updateValue()},removeCondition(t,e){this.groups[t].conditions.splice(e,1),this.updateValue()},createDefaultCondition(){var n;const t=this.fields[0],e=((n=this.getOperatorsForType(t==null?void 0:t.value)[0])==null?void 0:n.value)||"=";let a="";return(t==null?void 0:t.type)==="date"&&(a={type:"relative",value:"TODAY"}),{attribute:(t==null?void 0:t.value)||"",operator:e,value:a}},moveGroupUp(t){if(t>0){const e=this.groups[t];this.$set(this.groups,t,this.groups[t-1]),this.$set(this.groups,t-1,e),this.updateValue()}},moveGroupDown(t){if(t<this.groups.length-1){const e=this.groups[t];this.$set(this.groups,t,this.groups[t+1]),this.$set(this.groups,t+1,e),this.updateValue()}},updateValue(){this.$emit("input",{groups:this.groups,globalConjunction:this.globalConjunction,limit:parseInt(this.limit)||this.defaultLimit})}},mounted(){this.groups=this.initializeGroups(),this.value&&this.value.limit&&(this.limit=this.value.limit)}};var Z=function(){var e=this,a=e._self._c;return a("div",{staticClass:"query-builder max-w-4xl mx-auto"},[a("div",{staticClass:"flex items-center justify-between mb-4"},[a("div",{staticClass:"flex items-center justify-between w-full space-x-4"},[e.showLimit?a("div",{staticClass:"flex items-center space-x-2"},[a("label",{staticClass:"text-sm",attrs:{for:"limit"}},[e._v(e._s(e.__("Limit results")))]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.limit,expression:"limit"}],staticClass:"input-text w-24",attrs:{type:"number",id:"limit",min:"1"},domProps:{value:e.limit},on:{input:[function(n){n.target.composing||(e.limit=n.target.value)},e.updateValue]}})]):e._e(),a("button",{staticClass:"btn-primary",on:{click:e.addGroup}},[e._v(e._s(e.__("Add Group")))])])]),a("div",{staticClass:"space-y-6"},[e.groups.length>0?a("div",{staticClass:"flex justify-center"},[a("button",{staticClass:"insert-group-btn",attrs:{title:e.__("Insert group here")},on:{click:function(n){return e.insertGroupAt(0)}}},[a("svg",{staticClass:"w-4 h-4",attrs:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"}},[a("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"}})])])]):e._e(),e._l(e.groups,function(n,s){return[a("query-group",{key:`group-${s}`,attrs:{group:n,"group-index":s,fields:e.fields,operators:e.operators,"can-move-up":s>0,"can-move-down":s<e.groups.length-1,"can-remove":e.groups.length>1},on:{"update-group":e.updateGroup,"remove-group":e.removeGroup,"move-group-up":e.moveGroupUp,"move-group-down":e.moveGroupDown,"add-condition":e.addConditionToGroup,"update-condition":e.updateCondition,"remove-condition":e.removeCondition}}),s<e.groups.length-1?a("div",{key:`separator-${s}`,staticClass:"flex flex-col items-center space-y-2"},[a("button",{staticClass:"insert-group-btn",attrs:{title:e.__("Insert group here")},on:{click:function(u){return e.insertGroupAt(s+1)}}},[a("svg",{staticClass:"w-4 h-4",attrs:{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"}},[a("path",{attrs:{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"}})])])]):e._e()]})],2),e.groups.length?e._e():a("div",{staticClass:"text-center py-8 bg-gray-50 rounded-lg"},[a("p",{staticClass:"text-gray-500 mb-4"},[e._v(e._s(e.__('No groups added yet. Click "Add Group" to start building your query.')))])]),e.groups.length>1?a("div",{staticClass:"mt-6 pt-4 border-t border-gray-200"},[a("div",{staticClass:"flex items-center space-x-4"},[a("label",{staticClass:"font-bold"},[e._v(e._s(e.__("Combine Groups with:")))]),a("v-select",{staticClass:"w-32",attrs:{options:e.logicalOperators},on:{input:e.updateValue},model:{value:e.globalConjunction,callback:function(n){e.globalConjunction=n},expression:"globalConjunction"}})],1)]):e._e()])},ee=[],te=r(J,Z,ee,!1,null,"17645b68",null,null);const ae=te.exports,ne={components:{QueryBuilder:ae},mixins:[Fieldtype],data(){return{attributes:[]}},methods:{async fetchAttributes(){try{const t=await this.$axios.get("/cp/rapidez/product-attributes");this.attributes=t.data.map(e=>({label:e.store_frontend_label?e.store_frontend_label+` (${e.attribute_code})`:e.attribute_code,value:e.attribute_code,type:this.mapAttributeType(e.frontend_input),options:this.mapAttributeOptions(e.attribute_options)}))}catch(t){console.error("Error fetching attributes:",t)}},mapAttributeType(t){return{text:"text",textarea:"text",select:"select",multiselect:"select",boolean:"select",price:"number",weight:"number",date:"date",datetime:"date",timestamp:"date"}[t]||"text"},mapAttributeOptions(t){return t.length?(typeof t=="object"&&!Array.isArray(t)&&(t=Object.values(t)),t.map(e=>({label:e.store_value||e.option_id,value:e.option_id}))):[]}},mounted(){this.fetchAttributes()}};var se=function(){var e=this,a=e._self._c;return a("query-builder",{attrs:{fields:e.attributes,"default-limit":100,"show-limit":!0},model:{value:e.value,callback:function(n){e.value=n},expression:"value"}})},ie=[],le=r(ne,se,ie,!1,null,null,null,null);const re=le.exports;Statamic.booting(()=>{Statamic.component("product_query_builder-fieldtype",re)});
